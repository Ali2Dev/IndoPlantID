@model DocumentViewModel

<link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
      integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY="
      crossorigin="" />

<div class="table-wrapper">
    <table class="table table-striped table-hover">
        <thead>

        <tr>
            <th scope="col">Id</th>
            <th scope="col">Title</th>
        </tr>
        </thead>

        <tbody>

        @foreach (var item in Model.Documents)
        {
            <tr>

                <th scope="row">@item.Id</th>

                <td>@item.Title</td>

            </tr>
        }
        </tbody>

    </table>
</div>

<div class="row mt-3">
    <div class="col-md-6 offset-md-3">
        <h2>Yüklediğiniz Fotoğraf</h2>
        <img class="img-fluid rounded" id="preview" src="" alt="Önizleme" style="display:none; width: 50%;" />

        @*   @if (Model.FileContent != null)
        {
        <img src="data:image/jpeg;base64,@Convert.ToBase64String(Model.FileContent)" alt="Uploaded Image" style="max-width: 100%; height: auto;" />
        } *@

    </div>
</div>


<div class="row">
    <div class="col-md-6 offset-md-3">
        <h2>Fotoğraf Yükleyiniz</h2>

        <form asp-controller="Test" asp-action="UploadImage" method="post" enctype="multipart/form-data">

            <div class="row mb-3">
                <label class="col-md-4 col-form-label">Fotoğraf yükleyin:</label>
                <div class="col-md-8">
                    <input class="form-control" id="fileUpload" type="file" name="file" />
                </div>
            </div>


            <div class="row mb-3">

                <div class="col-md-8 offset-md-4">
                    <button type="submit" class="btn btn-primary">Yükle</button>

                    <a class="btn btn-warning ms-4" href="https://demo.roboflow.com/ev-bitkisi-tanima/1?publishable_key=rf_eBE2SLq9dEZYXkDRdsjU75PtjQt1" target="_blank"><i class="bi bi-camera me-3 fs-5"></i>Kamerayı Aç</a>

                </div>
            </div>

        </form>

    </div>
</div>

@if (Model.RoboflowResponse != null)
{
    <div class="text-center">
        <h1 class="display-6">Sonuç</h1>

        <ul>
            <li>Bitki No :  @Model.RoboflowResponse.ClassId</li>
            <li>Eşleşme oranı : %@Model.RoboflowResponse.Confidence</li>
            <li>Bitki Adı :  @Model.RoboflowResponse.PlantName</li>
        </ul>

    </div>
}



@if (TempData["RoboflowFailed"] != null)  
{
    <div class="text-center">
        <h1 class="display-6">:(</h1>
        <h6>@TempData["RoboflowFailed"]</h6>
    </div>
}

@if (TempData["PlantNetTempData"]!= null)
{
<div class="text-center">
    <h1 class="display-6">Sonuç</h1>
        <h6>@TempData["PlantNetTempData"]</h6>
</div>
}

@if (TempData["GPTResponse"] != null)
{
    <div class="text-center">
        <h1 class="display-6">Sonuç</h1>
        <h6>@TempData["GPTResponse"]</h6>
    </div>
}

<div class="text-center">
    <div id="map"></div>
</div>



<script>
    document.getElementById('fileUpload').addEventListener('change', function (event) {
        var reader = new FileReader();
        reader.onload = function (e) {
            var preview = document.getElementById('preview');
            preview.src = e.target.result;
            preview.style.display = 'block';
        };
        reader.readAsDataURL(event.target.files[0]);
    });
</script>
@section Scripts {

    <script src="~/js/site.js" asp-append-version="true"></script>

}
<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"
        integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo="
        crossorigin=""></script>

<script>
    // MAP İŞLEMLERİ
    var map = L.map('map').setView([0, 0], 2);

    L.tileLayer('https://tile.openstreetmap.org/{z}/{x}/{y}.png', {
        maxZoom: 19,
        attribution: '&copy; <a href="http://www.openstreetmap.org/copyright">OpenStreetMap</a>'
    }).addTo(map);


    var locationData = JSON.parse('@Html.Raw(TempData["LocationData"])');

    // JavaScript objesini kullanarak haritaya marker ekleyin
    locationData.forEach(function (loc) {
        var marker = L.marker([loc.lat, loc.lon]).addTo(map)
            .bindPopup(loc.name);
    });

    // var parisAndIstanbulCoordinates = {
    //     "Paris": { lat: 48.8588897, lng: 2.3200410217200766 },
    //     "İstanbul": { lat: 41.006381, lng: 28.9758715 },
    // };


    // for (var region in parisAndIstanbulCoordinates) {
    //     var coords = parisAndIstanbulCoordinates[region];
    //     L.marker([coords.lat, coords.lng]).addTo(map)
    //         .bindPopup(region);
    // };
</script>